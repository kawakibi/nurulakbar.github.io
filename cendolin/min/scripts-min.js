!function(){function t(){var t,f,u,h,l;for(f=document.querySelectorAll("img.sprite"),h=f.length;h--;){for(t={},t.effects=[],t.img=f[h],t.offset=f[h].offsetWidth/2,u=f[h].getAttribute("data-collision").split(","),l=u.length;l--;){var d=u[l].split(":");t.effects.push({effect:d[0],value:d[1]})}t.type=f[h].getAttribute("data-type"),G.push(t)}K=G.length,it=+$("#characters").getAttribute("data-countstart"),nt=+$("#characters").getAttribute("data-newsprite"),L.tabIndex=-1,L.focus(),L.addEventListener("keydown",i,!1),L.addEventListener("keyup",n,!1),L.addEventListener("touchstart",r,!1),L.addEventListener("touchend",s,!1),L.addEventListener("click",e,!1),L.addEventListener("mousemove",o,!1),window.addEventListener("deviceorientation",a,!1),localStorage.html5catcher?et=JSON.parse(localStorage.html5catcher):(et={last:0,high:0},localStorage.html5catcher=JSON.stringify(et)),c(),"ondeviceorientation"in window&&($("#androidbrowsersucks").style.display="none")}function e(t){var e=t.target;"gameover"===z&&"replay"===e.id&&c(),"next"===e.className&&h(),"endinstructions"===e.className&&u(),"instructionbutton"===e.id&&f(),"playbutton"===e.id&&l(),t.preventDefault()}function i(t){39===t.keyCode?rt=!0:37===t.keyCode&&(st=!0)}function n(t){39===t.keyCode?rt=!1:37===t.keyCode&&(st=!1)}function r(t){"playing"===z&&t.preventDefault(),t.target===H?rt=!0:t.target===k&&(st=!0)}function s(t){"playing"===z&&t.preventDefault(),t.target===H?rt=!1:t.target===k&&(st=!1)}function a(t){t.gamma<0&&(X-=2),t.gamma>0&&(X+=2),V>X&&(X=V),X>Y-V&&(X=Y-V)}function o(t){var e=t.clientX-L.offsetLeft;V>e&&(e=V),e>Y-V&&(e=Y-V),X=e}function c(){A(N),z="intro";var t=N.querySelectorAll("output");t[0].innerHTML=et.last,t[1].innerHTML=et.high}function f(){A(S),z="instructions",P=0,R[P].className="current"}function u(){R[P].className="introdeck",P=0,c()}function h(){R[P+1]&&(P+=1),R[P]&&(R[P-1].className="introdeck",R[P].className="current")}function l(){for(A(b),z="playing",document.body.className="playing",Y=b.offsetWidth,Z=b.offsetHeight,E.width=Y,E.height=Z,U=Z-q.offsetHeight,V=q.offsetWidth/2,X=Y/2,B=[],tt=0;it>tt;tt++)B.push(v());I.energy=D,_=0,O=0,T.innerHTML=D,d()}function d(){for(W.clearRect(0,0,Y,Z),j=B.length,tt=0;tt<j;tt++)B[tt].render(),B[tt].update();T.innerHTML=I.energy,M.innerHTML=~~(O/10),O++,~~(O/nt)>_&&(B.push(v()),_++),rt&&m(),st&&g(),W.save(),W.translate(X-V,U),W.drawImage(q,0,0),W.restore(),I.energy=Math.min(I.energy,100),I.energy>0?requestAnimationFrame(d):y()}function g(){X-=J,V>X&&(X=V)}function m(){X+=J,X>Y-V&&(X=Y-V)}function y(){document.body.className="gameover",A(F),z="gameover";var t=~~(O/10);F.querySelector("output").innerHTML=t,et.last=t,t>et.high&&(C.innerHTML=C.getAttribute("data-highscore"),et.high=t),localStorage.html5catcher=JSON.stringify(et)}function p(){this.px=0,this.py=0,this.vx=0,this.vy=0,this.goodguy=!1,this.height=0,this.width=0,this.effects=[],this.img=null,this.update=function(){if(this.px+=this.vx,this.py+=this.vy,~~(this.py+10)>U&&X-V<this.px&&this.px<X+V)for(this.py=-200,tt=this.effects.length;tt--;)I[this.effects[tt].effect]+=+this.effects[tt].value;if((this.px>Y-this.offset||this.px<this.offset)&&(this.vx=-this.vx),this.py>Z+100){if("good"===this.type)for(tt=this.effects.length;tt--;)I[this.effects[tt].effect]-=+this.effects[tt].value;w(this)}},this.render=function(){W.save(),W.translate(this.px,this.py),W.translate(this.width*-.5,this.height*-.5),W.drawImage(this.img,0,0),W.restore()}}function v(){var t=new p;return w(t),t}function w(t){var e=~~x(0,K);t.img=G[e].img,t.height=t.img.offsetHeight,t.width=t.img.offsetWidth,t.type=G[e].type,t.effects=G[e].effects,t.offset=G[e].offset,t.py=-100,t.px=x(t.width/2,Y-t.width/2),t.vx=x(-1,2),t.vy=x(1,5)}function $(t){return document.querySelector(t)}function x(t,e){return Math.random()*(e-t)+t}function A(t){Q&&(Q.className=""),t.className="current",Q=t}var L=$("#container"),b=$("#playfield"),q=$("#player"),N=$("#intro"),S=$("#instructions"),k=$(".left"),H=$(".right"),M=$("#score output"),T=$("#energy output"),E=$("canvas"),F=$("#gameover"),C=F.querySelector(".message"),R=document.querySelectorAll("li.introdeck"),W=E.getContext("2d"),D=+T.innerHTML,I={energy:D},J=+q.getAttribute("data-increase"),O=0,z=null,X=0,B=[],G=[],K=0,P=0,Q=null,U=0,V=0,Y=0,Z=0,_=0,tt=0,et=null,it=0,nt=500,rt=!1,st=!1;window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}()),t()}();